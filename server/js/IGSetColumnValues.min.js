window.mho=window.mho||{},function(t){function e(t){this.ig$=t.ig$,this.grid=t.grid,this.model=this.grid.model,this.da=t.da,this.type=t.type,this.ajaxIdentifier=t.ajaxIdentifier,this.itemsToSubmit=t.itemsToSubmit,this.staticValue=t.staticValue,this.jsColumns=t.jsColumns,this.jsExpression=t.jsExpression,this.dialogReturnItem=t.dialogReturnItem,this.recordSelection=t.recordSelection,this.columnConfig=this.ig$.interactiveGrid("option","config.columns"),this.affectedColumns=t.affectedColumns,this.updateMethods={static:this.updateWithStaticValue,js:this.updateWithJavaScriptExpressionValues,sql:this.ajaxCallback,plsql:this.ajaxCallback,function:this.ajaxCallback,dialog:this.updateWithDialogReturnItems},this.setRecords(),this.data=this.getCurrentData()}function i(t){let e=apex.region(t),i=e.widget(),a=$.Deferred();return i.length>0?a.resolve(i):e.element.on("interactivegridcreate",function(){a.resolve(e.widget())}),a.promise()}function a(t){let a;i($(t.da.triggeringElement).attr("id")).done(function(i){t.ig$=i;let a=i.interactiveGrid("getViews").grid;if(!a)return;let n=t.affectedColumns.split(","),s=t.jsColumns.split(","),r=new e({ig$:i,grid:a,da:t.da,type:t.type,ajaxIdentifier:t.ajaxIdentifier,itemsToSubmit:t.itemsToSubmit,staticValue:t.staticValue,jsColumns:s,jsExpression:t.jsExpression,dialogReturnItem:t.dialogReturnItem,recordSelection:t.recordSelection,affectedColumns:n});r.getValues().then(function(){r.setValues()})})}e.prototype.filterJsColumns=function(){let t=this;this.jsColumns=this.jsColumns.filter(function(e){let i;return t.columnConfig.filter(function(t){return t.name===e})[0]})},e.prototype.setRecords=function(){let t=this,e={selected:function(){return t.ig$.interactiveGrid("getSelectedRecords")},all:function(e){let i=[];return t.model.forEach(function(t){i.push(t)}),i}};this.records=e[this.recordSelection].apply(this)},e.prototype.getValues=function(){return this.updateMethods[this.type].apply(this)},e.prototype.setValues=function(){let t=this,e=!0;function i(t){let e;return e="number"==typeof t?t.toString():null===t?"":t}t.records.forEach(function(a,n){t.ig$.interactiveGrid("setSelectedRecords",a,e),e=!1,t.grid.setEditMode(!0),t.data[n].forEach(function(t){t.isAffected&&(Array.isArray(t.value)&&(t.value=t.value.map(i)),apex.item(t.staticId).setValue(t.value))})}),t.ig$.interactiveGrid("setSelectedRecords",t.records),t.grid.setEditMode(!1),apex.da.resume(t.da.resumeCallback,!1)},e.prototype.getCurrentData=function(){let t=this,e;return this.records.map(function(i){return t.columnConfig.map(function(a){return(e=t.model.getValue(i,a.name))&&e.v&&(Array.isArray(e.v)&&(e=e.v.join(":")),e=e.v),e=e||"",{name:a.name,value:e,dataType:a.dataType,formatMask:a.appearance.formatMask,isReadOnly:a.isReadOnly,isAffected:t.affectedColumns.indexOf(a.name)>-1,staticId:a.staticId}})})},e.prototype.ajaxCallback=function(){let t=this,e=$.Deferred();return apex.server.plugin(this.ajaxIdentifier,{x01:this.type,p_clob_01:JSON.stringify(this.data),pageItems:this.itemsToSubmit},{loadingIndicator:this.ig$,loadingIndicatorPosition:"centered"}).then(function(i){t.data=i,e.resolve()}),e.promise()},e.prototype.updateWithStaticValue=function(){let t=this,e=$.Deferred();return this.data=this.data.map(function(e){return e.map(function(e){return e.isAffected&&(e.value=t.staticValue),e})}),e.resolve(),e.promise()},e.prototype.updateWithJavaScriptExpressionValues=function(){let t=this,e=$.Deferred(),i=[],a;return this.data=this.data.map(function(e){return i=[],i=t.jsColumns.map(function(t){let i=e.filter(function(e){return e.name===t})[0];return i?i.value:""}),e.map(function(e){return e.isAffected&&(a=t.jsExpression.apply(null,i),e.value=a),e})}),e.resolve(),e.promise()},e.prototype.updateWithDialogReturnItems=function(){return console.log(this.da.data),this.staticValue=this.da.data[this.dialogReturnItem],this.updateWithStaticValue()},t.IGSetColumnValues={setValue:a}}(window.mho);